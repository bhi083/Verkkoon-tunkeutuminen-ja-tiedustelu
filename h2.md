# h2 Lempiväri: violetti

## x) Lue ja vastaa

### Bianco 2013: [Pyramid of Pain](https://detect-respond.blogspot.com/2013/03/the-pyramid-of-pain.html)

Tuskan pyramidi näyttää, mitä asioita muuttamalla/miten reagoimalla saadaan hyökkääjälle aikaiseksi eniten tuskaa. 

Alimpana on hashit, niitä muuttamalla hyökkääjä voi vain cracakta hashit uudestaan. 

Ylimpänä on TTP:t, eli Taktiikat, tekniikat ja proseduurit. Näitä muuttamalla hyökkääjä joutuu opettelemaan täysin uuden tavan hyökätä onnistuakseen.

### Caltagirone et al 2013: [The Diamond Model](https://www.threatintel.academy/wp-content/uploads/2020/07/diamond-model.pdf)

Timanttimallissa on neljä kulmaa, eli neljä osaa: Viholliset, infrastruktuuri, kyvykkyydet ja uhri. 

Kaikki tietoturvatilanteet ovat näiden osien välinen tapahtuma.

Timanttimallilla voidaan linkittää tapahtumien kulkua eri osiin ja ymmärtää tapahtuma paremmin, analysoida heikkouksia jne.

## a) Apache log

Ensimmäiseksi asensin ja käynnistin Apache2:

    sudo apt-get update
    sudo apt-get install apache2
    sudo systemctl start apache2

Tämän jälkeen avasin Apachen default sivun osoitteesta http://localhost, ja se toimi niin kuin pitikin.

Avasin Apachen lokit:

    cd /var/log/apache2
    micro access.log

<img width="2244" height="90" alt="Näyttökuva 2025-11-02 194926" src="https://github.com/user-attachments/assets/13a9c17b-fa9b-4360-9401-4da1bb096641" />

Lokeista näkyy pyyntöjen kellonajat, käytetyt selaimet, käyttöjärjestelmät sekä millainen pyyntö on kyseessä.

## b) Nmapped

<img width="1852" height="478" alt="Näyttökuva 2025-11-02 195440" src="https://github.com/user-attachments/assets/0be79b09-4961-4526-b1fa-c0e1937afba2" />

Skannauksessa näkyy Apache2:n käyttämä 80-portti avoinna. 80 on TCP-portti. Skannauksesta näkyy myös Apachen default sivun header, ja käyttöjärjestelmätietoja.

## c) Skriptit

Kuten edellisen tehtävän kuvassa näkyy, skriptit, jotka olivat päällä:

http-title

http-server-header

## d) Jäljet lokissa

<img width="2176" height="713" alt="Näyttökuva 2025-11-02 204617" src="https://github.com/user-attachments/assets/c9ab430e-d6bb-4e63-8d31-6a2d6628b16b" />

Useammallakin rivillä lukee ihan selkotekstillä "Nmap Scripting Engine"

Nmap-skannauksia voisi etsiä lokeista esimerkiksi hakusanoilla nmap, Nmap, Nmap Scripting Engine, nmaplowercheck

## e) Wire Sharking

<img width="2810" height="685" alt="Näyttökuva 2025-11-02 205454" src="https://github.com/user-attachments/assets/197cde54-b3a8-47d8-ba33-1dafcbf61436" />

Filtteröimällä saatiin wiresharkin tulokset, joissa mainitaan Nmap.

<img width="1386" height="228" alt="Näyttökuva 2025-11-02 205721" src="https://github.com/user-attachments/assets/7b9d69c3-28c7-4807-a350-06b063be82b4" />

Ihan jokaisessa tuloksessa ei ollut identtinen, mutta suurin piirtein tämän kaltainen. Eli HTTP User Agent-kohdassa mainitaan Nmap selkokielisesti kirjoitettuna.

## f)

<img width="1407" height="1362" alt="Näyttökuva 2025-11-02 210338" src="https://github.com/user-attachments/assets/ebb884d9-33d6-4a12-9ead-f6a0c5626926" />

    sudo ngrep -d lo -i nmap

ngrep-komennolla voi tarkkailla verkkoliikennettä wiresharkin tapaan. Kuvankaappauksessa yllä olevan komennon tulokset, kun nmappia käytettiin.

## g) Agentti

<img width="1431" height="57" alt="Näyttökuva 2025-11-02 211958" src="https://github.com/user-attachments/assets/383b3998-ebf8-4716-bb9f-d3204246b6fe" />

Höhöö. Huumoria

Nyt Nmapin ei PITÄISI lukea kaikissa lokeissa ja wiresharkin sieppaamissa paketeissa.

## h) Pienemmät jäljet

<img width="1964" height="668" alt="Näyttökuva 2025-11-02 212235" src="https://github.com/user-attachments/assets/a8ce33f2-9073-4083-b798-28d38ee53df9" />

Apachen lokeissa vain "nmaplowercheck" paljastaa meidät.

<img width="2879" height="227" alt="Näyttökuva 2025-11-02 212014" src="https://github.com/user-attachments/assets/cf73e276-340d-4ea3-86dc-83fbab7b1d0b" />

<img width="1218" height="249" alt="Näyttökuva 2025-11-02 212030" src="https://github.com/user-attachments/assets/10d52371-098b-4c99-9c92-619c1003729c" />

Sama juttu Wiresharkilla

Muuten nmap ei enää mainita lokeissa.

## i) 

Etsitään tiedosto, joka lisää LoWer cHecKin

    grep -rnw '/usr/share/nmap/' -e 'nmaplowercheck'

<img width="1228" height="103" alt="Näyttökuva 2025-11-02 214150" src="https://github.com/user-attachments/assets/0cefc1f6-07ee-451b-ab67-ca00768bac70" />

Sieltä löytyi.

    cd nselib
    sudoedit http.lua

sudoeditillä haetaan rivi 2625, ja muutetaan stringit:

<img width="871" height="100" alt="Näyttökuva 2025-11-02 214136" src="https://github.com/user-attachments/assets/3ff22c75-6a95-4d57-8b8f-150d07aa2a8d" />

En tiiä mistä tää samsung tuli mutta sillä nyt mennään.

Ja kun kokeillaan nmap uudestaan niin mitä sanoo wirehark?

<img width="2879" height="287" alt="Näyttökuva 2025-11-02 214046" src="https://github.com/user-attachments/assets/c5ea2ffe-a3a6-42ec-9d41-0b73eac887b6" />

<img width="1428" height="358" alt="Näyttökuva 2025-11-02 214109" src="https://github.com/user-attachments/assets/9ec22a8c-8e61-4813-a539-23ab53a4def5" />

Ei Nmappia mailla halmeilla! Entäs Apache logs?

<img width="1989" height="698" alt="Näyttökuva 2025-11-02 214501" src="https://github.com/user-attachments/assets/e4e87311-f6ee-455b-83d9-0322ab4cc432" />

Pelkkä samsung mainittu! Tähän semmonen raporttivälitteinen mikrofonin pudotus, kiitos ja kumarrus.

## Lähteet

Karvinen 2025: [Verkkoon tunkeutuminen ja tiedustelu](https://terokarvinen.com/verkkoon-tunkeutuminen-ja-tiedustelu/#h2-lempivari-violetti)

Bianco 2013: [Pyramid of Pain](https://detect-respond.blogspot.com/2013/03/the-pyramid-of-pain.html)

Caltagirone et al 2013: [The Diamond Model](https://www.threatintel.academy/wp-content/uploads/2020/07/diamond-model.pdf)
